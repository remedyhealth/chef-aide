#!/bin/bash

if [ "$1" == "success" ]; then
  CHANGED=$(grep -A4 'Summary:' /var/log/aide/aide.log | grep 'Changed entries' | awk '{print $NF}')
  if [ -z "$CHANGED" ]; then
    exit 0
  fi
  if [ "${CHANGED}" != "0" ]; then
    curl -s -X POST -H 'Content-type: application/json' --data "{'text': '*`hostname -f`* is reporting *${CHANGED}* changed files'}" <%= @slack_webhook_url %> > /dev/null
  fi
else
  curl -s -X POST -H 'Content-type: application/json' --data "{'text': '*`hostname -f`* had status *${1}*.'}" <%= @slack_webhook_url %> > /dev/null
fi
